id: serverboards.telegram
name: Telegram notifications
description: |
  Telegram integration to allow sending notifications via telegram
author: David Moreno <dmoreno@serverboards.io>
url: https://serverboards.io
version: 0.1.0

components:
  - id: settings.telegram
    type: settings
    perms: settings
    name: Telegram settings
    description: |
      Telegram settings required to send telegrams to users.

      You can get a new API token using the
      [BotFather](https://web.telegram.org/#/im?p=@BotFather) telegram bot.

      Just create a new bot and add here the token.

      Users must connect to the bot with the given name, and will receive a
      code within a minute.
    fields:
      - name: token
        label: API Key
        description:: API token as given by the BotFather

  - id: telegram
    type: notification
    name: Telegram notifications
    description: A code will be sent to pair. Please connect to the [@serverboards_test_bot](https://web.telegram.org/#/im?p=@serverboards_test_bot) in telegram.
    command: serverboards.telegram/daemon.telegram
    fields:
      - name: code
        label: User code
        type: text
        description: Code as sent by the serverboards_test_bot. Needed to pair user and chats.
    call: send_telegram

  - id: daemon.telegram
    type: cmd
    traits: telegram
    perms:
      - settings.view[serverboards.telegram/settings.telegram]
      - plugin.data[serverboards.telegram/telegram]
    command: serverboards_telegram.py
    type: singleton
    timeout: 3600s

  - id: refresh
    type: action
    command: serverboards.telegram/daemon.telegram
    call:
      method: message_check
      params:
        - name: timeout
          value: 59

  - id: refresh_cron
    name: Check for new messages and users
    type: cron
    cron: "* * * * *"
    action: serverboards.telegram/refresh
